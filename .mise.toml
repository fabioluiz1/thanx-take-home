[tools]
awscli = "2.22.14"
bun = "1.1.43"
hadolint = "2.14.0"
# Using pipx backend because pre-commit 4.5.0+ stopped publishing sha256sum files,
# breaking aqua backend
"pipx:pre-commit" = "4.5.1"
ruby = "4.0.0"
terraform = "1.10.4"

[tasks.setup]
description = "Install dependencies and pre-commit hooks"
run = '''
  gem install rails
  cd api && bundle install
  pre-commit install --hook-type pre-commit
  pre-commit install --hook-type commit-msg
'''

[tasks.lint]
description = "Run all pre-commit hooks"
run = "pre-commit run --all-files"

[tasks."tf:init"]
description = "Initialize Terraform with S3 backend"
dir = "terraform"
run = '''
  BUCKET="rewards-app-tf-state-$(aws sts get-caller-identity --query Account --output text)"
  terraform init -backend-config="bucket=$BUCKET"
'''
